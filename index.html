<!doctype html>
<html lang="pt-BR">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Anjo da Guarda</title>
  <script src="/_sdk/data_sdk.js"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <style>
    body {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      height: 100%;
      overflow: hidden;
    }

    html {
      height: 100%;
    }

    * {
      box-sizing: border-box;
    }

    #app {
      height: 100%;
      display: flex;
      flex-direction: column;
      max-width: 480px;
      margin: 0 auto;
      background: white;
      box-shadow: 0 0 50px rgba(0,0,0,0.3);
    }

    .screen {
      display: none;
      flex-direction: column;
      height: 100%;
      overflow-y: auto;
      animation: fadeIn 0.3s ease-in;
    }

    .screen.active {
      display: flex;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    /* Header */
    .header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 20px;
      text-align: center;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      position: relative;
    }

    .header h1 {
      margin: 0;
      font-size: 24px;
      font-weight: 600;
    }

    .header p {
      margin: 8px 0 0 0;
      font-size: 14px;
      opacity: 0.95;
    }

    /* Content */
    .content {
      flex: 1;
      padding: 24px;
      overflow-y: auto;
    }

    /* Login Screen */
    .login-form {
      display: flex;
      flex-direction: column;
      gap: 16px;
      max-width: 400px;
      margin: 40px auto;
    }

    .form-group {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .form-group label {
      font-size: 14px;
      font-weight: 600;
      color: #333;
    }

    .form-group input, .form-group select {
      padding: 12px 16px;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      font-size: 16px;
      transition: border-color 0.3s;
      font-family: inherit;
    }

    .form-group input:focus, .form-group select:focus {
      outline: none;
      border-color: #667eea;
    }

    .btn {
      padding: 14px 24px;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      text-align: center;
    }

    .btn-primary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
    }

    .btn-secondary {
      background: white;
      color: #667eea;
      border: 2px solid #667eea;
    }

    .btn-secondary:hover {
      background: #f5f5ff;
    }

    /* Navigation */
    .nav-bottom {
      display: flex;
      background: white;
      border-top: 1px solid #e0e0e0;
      box-shadow: 0 -2px 10px rgba(0,0,0,0.05);
      position: relative;
      z-index: 10;
    }

    .nav-item {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
      padding: 12px 8px;
      background: none;
      border: none;
      cursor: pointer;
      color: #999;
      transition: color 0.3s;
      font-size: 12px;
    }

    .nav-item:hover,
    .nav-item.active {
      color: #667eea;
      background: #f5f5ff;
    }

    .nav-item .icon {
      font-size: 24px;
      display: block;
    }

    .nav-item .label {
      font-size: 11px;
      font-weight: 500;
      display: block;
      white-space: nowrap;
    }

    /* Emergency Button */
    .emergency-btn {
      position: fixed;
      bottom: 80px;
      left: 50%;
      transform: translateX(-50%);
      width: 60px;
      height: 60px;
      background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%);
      border: none;
      border-radius: 50%;
      color: white;
      font-size: 28px;
      cursor: pointer;
      box-shadow: 0 6px 24px rgba(255, 107, 107, 0.6);
      z-index: 1000;
      transition: all 0.3s;
      animation: pulse 2s infinite;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .emergency-btn:hover {
      transform: translateX(-50%) scale(1.1);
      box-shadow: 0 8px 32px rgba(255, 107, 107, 0.8);
    }

    @keyframes pulse {
      0%, 100% { box-shadow: 0 6px 24px rgba(255, 107, 107, 0.6); }
      50% { box-shadow: 0 8px 32px rgba(255, 107, 107, 0.9); }
    }

    /* Den√∫ncia Form */
    .report-form {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .checkbox-group {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .checkbox-group input[type="checkbox"] {
      width: 20px;
      height: 20px;
      cursor: pointer;
    }

    textarea {
      padding: 12px 16px;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      font-size: 16px;
      font-family: inherit;
      resize: vertical;
      min-height: 100px;
    }

    textarea:focus {
      outline: none;
      border-color: #667eea;
    }

    /* Success Message */
    .success-box {
      background: #e8f5e9;
      border: 2px solid #4caf50;
      border-radius: 12px;
      padding: 24px;
      text-align: center;
      margin: 24px 0;
    }

    .success-box .icon {
      font-size: 64px;
      margin-bottom: 16px;
    }

    .success-box h2 {
      margin: 0 0 12px 0;
      color: #2e7d32;
    }

    .protocol {
      font-size: 24px;
      font-weight: 700;
      color: #667eea;
      margin: 16px 0;
      padding: 12px;
      background: white;
      border-radius: 8px;
    }

    /* Reports List */
    .reports-list {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .report-item {
      background: #f8f9fa;
      border: 2px solid #e0e0e0;
      border-radius: 12px;
      padding: 16px;
      cursor: pointer;
      transition: all 0.3s;
    }

    .report-item:hover {
      border-color: #667eea;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }

    .report-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }

    .report-protocol {
      font-weight: 700;
      color: #667eea;
    }

    .status-badge {
      padding: 4px 12px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 600;
    }

    .status-pending {
      background: #fff3cd;
      color: #856404;
    }

    .status-analyzing {
      background: #cce5ff;
      color: #004085;
    }

    .status-completed {
      background: #d4edda;
      color: #155724;
    }

    /* Games */
    .games-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
      gap: 16px;
      margin-top: 16px;
    }

    .game-card {
      background: white;
      border: 2px solid #e0e0e0;
      border-radius: 12px;
      padding: 16px;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s;
    }

    .game-card:hover {
      border-color: #667eea;
      transform: translateY(-4px);
      box-shadow: 0 8px 20px rgba(0,0,0,0.1);
    }

    .game-card .icon {
      font-size: 48px;
      margin-bottom: 8px;
    }

    .game-card h3 {
      margin: 0;
      font-size: 16px;
      color: #333;
    }

    /* Quiz */
    .quiz-container {
      max-width: 500px;
      margin: 0 auto;
    }

    .question-box {
      background: #f8f9fa;
      border-radius: 12px;
      padding: 24px;
      margin-bottom: 24px;
    }

    .question-box h2 {
      margin: 0 0 20px 0;
      color: #333;
      font-size: 20px;
    }

    .options {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .option-btn {
      padding: 16px;
      background: white;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
      transition: all 0.3s;
      text-align: left;
    }

    .option-btn:hover {
      border-color: #667eea;
      background: #f5f5ff;
    }

    .option-btn.correct {
      border-color: #4caf50;
      background: #e8f5e9;
    }

    .option-btn.incorrect {
      border-color: #f44336;
      background: #ffebee;
    }

    /* Map */
    .map-container {
      background: #e0e0e0;
      height: 300px;
      border-radius: 12px;
      margin-bottom: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #666;
      font-size: 48px;
      position: relative;
      overflow: hidden;
    }

    .map-markers {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
    }

    .map-marker {
      position: absolute;
      font-size: 32px;
      cursor: pointer;
      transition: transform 0.3s;
    }

    .map-marker:hover {
      transform: scale(1.3);
    }

    .places-list {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .place-item {
      background: white;
      border: 2px solid #e0e0e0;
      border-radius: 12px;
      padding: 16px;
      cursor: pointer;
      transition: all 0.3s;
    }

    .place-item:hover {
      border-color: #667eea;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }

    .place-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 8px;
    }

    .place-icon {
      font-size: 32px;
    }

    .place-info h3 {
      margin: 0 0 4px 0;
      font-size: 18px;
      color: #333;
    }

    .place-info p {
      margin: 0;
      font-size: 14px;
      color: #666;
    }

    /* Chat */
    .chat-container {
      display: flex;
      flex-direction: column;
      height: 100%;
    }

    .chat-messages {
      flex: 1;
      overflow-y: auto;
      padding: 16px;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .message {
      max-width: 80%;
      padding: 12px 16px;
      border-radius: 16px;
      font-size: 15px;
      line-height: 1.4;
    }

    .message.bot {
      background: #f0f0f0;
      align-self: flex-start;
    }

    .message.user {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      align-self: flex-end;
    }

    .chat-options {
      display: flex;
      flex-direction: column;
      gap: 8px;
      padding: 0 16px;
      margin-bottom: 16px;
    }

    .chat-option-btn {
      padding: 12px 16px;
      background: white;
      border: 2px solid #667eea;
      border-radius: 20px;
      color: #667eea;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.3s;
    }

    .chat-option-btn:hover {
      background: #667eea;
      color: white;
    }

    /* Back Button */
    .back-btn {
      position: absolute;
      top: 20px;
      left: 20px;
      background: rgba(255,255,255,0.3);
      border: none;
      color: white;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      font-size: 20px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s;
    }

    .back-btn:hover {
      background: rgba(255,255,255,0.5);
    }

    /* Loading State */
    .loading {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid #f3f3f3;
      border-top: 3px solid #667eea;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .empty-state {
      text-align: center;
      padding: 40px 20px;
      color: #999;
    }

    .empty-state .icon {
      font-size: 64px;
      margin-bottom: 16px;
    }

    /* Chat Input */
    .chat-input-container {
      padding: 12px 16px;
      background: white;
      border-top: 1px solid #e0e0e0;
    }

    .chat-input-form {
      display: flex;
      gap: 8px;
      align-items: center;
    }

    .chat-input {
      flex: 1;
      padding: 12px 16px;
      border: 2px solid #e0e0e0;
      border-radius: 24px;
      font-size: 15px;
      font-family: inherit;
    }

    .chat-input:focus {
      outline: none;
      border-color: #667eea;
    }

    .chat-send-btn {
      width: 44px;
      height: 44px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border: none;
      border-radius: 50%;
      color: white;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s;
      flex-shrink: 0;
    }

    .chat-send-btn:hover {
      transform: scale(1.1);
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
    }

    .chat-send-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    /* Human Attendant Banner */
    .human-attendant-banner {
      background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%);
      color: white;
      padding: 16px;
      margin: 0;
      border-bottom: 2px solid rgba(255,255,255,0.3);
      animation: slideDown 0.3s ease-out;
    }

    @keyframes slideDown {
      from {
        transform: translateY(-100%);
        opacity: 0;
      }
      to {
        transform: translateY(0);
        opacity: 1;
      }
    }

    .human-attendant-banner strong {
      display: block;
      font-size: 16px;
    }

    /* Typing indicator */
    .typing-indicator {
      display: inline-flex;
      gap: 4px;
      padding: 12px 16px;
      background: #f0f0f0;
      border-radius: 16px;
      align-self: flex-start;
    }

    .typing-dot {
      width: 8px;
      height: 8px;
      background: #999;
      border-radius: 50%;
      animation: typing 1.4s infinite;
    }

    .typing-dot:nth-child(2) {
      animation-delay: 0.2s;
    }

    .typing-dot:nth-child(3) {
      animation-delay: 0.4s;
    }

    @keyframes typing {
      0%, 60%, 100% {
        transform: translateY(0);
      }
      30% {
        transform: translateY(-8px);
      }
    }

    /* Place Details */
    .place-details {
      background: white;
      border-radius: 12px;
      padding: 24px;
      margin-bottom: 16px;
    }

    .place-details h2 {
      margin: 0 0 16px 0;
      color: #333;
    }

    .detail-row {
      display: flex;
      gap: 12px;
      margin-bottom: 12px;
      align-items: flex-start;
    }

    .detail-row .icon {
      font-size: 20px;
      color: #667eea;
      margin-top: 2px;
    }

    .detail-row .text {
      flex: 1;
      color: #666;
      font-size: 15px;
    }

    /* Route */
    .route-map {
      background: #e0e0e0;
      height: 400px;
      border-radius: 12px;
      margin-bottom: 16px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 20px;
      text-align: center;
    }

    .route-map .icon {
      font-size: 64px;
      margin-bottom: 16px;
      color: #667eea;
    }

    .route-info {
      background: white;
      border-radius: 12px;
      padding: 20px;
    }

    .route-info h3 {
      margin: 0 0 12px 0;
      color: #333;
    }

    .route-step {
      display: flex;
      gap: 12px;
      margin-bottom: 12px;
      padding-bottom: 12px;
      border-bottom: 1px solid #e0e0e0;
    }

    .route-step:last-child {
      border-bottom: none;
      margin-bottom: 0;
      padding-bottom: 0;
    }

    .step-number {
      width: 28px;
      height: 28px;
      background: #667eea;
      color: white;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      font-size: 14px;
      flex-shrink: 0;
    }

    .step-text {
      flex: 1;
      color: #666;
      font-size: 15px;
    }

    .score-display {
      text-align: center;
      padding: 40px 20px;
    }

    .score-display .icon {
      font-size: 80px;
      margin-bottom: 16px;
    }

    .score-display h2 {
      margin: 0 0 12px 0;
      font-size: 32px;
      color: #333;
    }

    .score-display p {
      margin: 0 0 24px 0;
      font-size: 18px;
      color: #666;
    }

    /* Chat List Item */
    .chat-list-item {
      background: white;
      border: 2px solid #e0e0e0;
      border-radius: 12px;
      padding: 16px;
      cursor: pointer;
      transition: all 0.3s;
      margin-bottom: 12px;
    }

    .chat-list-item:hover {
      border-color: #667eea;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }

    .chat-list-item.urgent {
      border-color: #ff6b6b;
      background: #fff5f5;
    }

    .chat-list-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }

    .chat-list-name {
      font-weight: 700;
      color: #333;
      font-size: 16px;
    }

    .chat-list-time {
      font-size: 12px;
      color: #999;
    }

    .chat-list-preview {
      color: #666;
      font-size: 14px;
      margin: 0;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .urgent-badge {
      display: inline-block;
      background: #ff6b6b;
      color: white;
      padding: 2px 8px;
      border-radius: 12px;
      font-size: 11px;
      font-weight: 600;
      margin-left: 8px;
    }

    @media (max-width: 480px) {
      .content {
        padding: 16px;
      }

      .emergency-btn {
        bottom: 70px;
        width: 56px;
        height: 56px;
        font-size: 24px;
      }
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
 </head>
 <body>
  <div id="app"><!-- Tela 1.0: Login -->
   <div id="screen-login" class="screen active">
    <div class="header">
     <h1>üëº Anjo da Guarda</h1>
     <p>Bem-vindo ao sistema de prote√ß√£o</p>
    </div>
    <div class="content">
     <form class="login-form" id="loginForm">
      <div class="form-group"><label for="email">Email</label> <input type="email" id="email" placeholder="Digite seu email" required>
      </div>
      <div class="form-group"><label for="password">Senha</label> <input type="password" id="password" placeholder="Digite sua senha" required>
      </div><button type="submit" class="btn btn-primary">Fazer Login</button>
      <button type="button" class="btn btn-secondary" id="createAccountBtn" style="margin-top: 12px;">Criar Conta</button>
      <div id="loginError" style="color: red; text-align: center; margin-top: 12px;"></div>
     </form>
    </div>
   </div>
   
   <!-- Tela de Registro -->
   <div id="screen-register" class="screen">
    <div class="header" style="position: relative;"><button class="back-btn" onclick="showScreen('screen-login')">‚Üê</button>
     <h1>üìù Criar Conta</h1>
     <p>Crie sua conta para acessar o sistema</p>
    </div>
    <div class="content">
     <form class="login-form" id="registerForm">
      <div class="form-group"><label for="regEmail">Email</label> <input type="email" id="regEmail" placeholder="Digite seu email" required>
      </div>
      <div class="form-group"><label for="regPassword">Senha</label> <input type="password" id="regPassword" placeholder="Digite sua senha" required>
      </div>
      <div class="form-group"><label for="userType">Tipo de Usu√°rio</label> <select id="userType" required> <option value="">Selecione</option> <option value="child">Crian√ßa</option> <option value="parent">Pai/Cidad√£o</option> <option value="professional">Profissional</option> </select>
      </div>
      <button type="submit" class="btn btn-primary">Criar Conta</button>
      <div id="registerError" style="color: red; text-align: center; margin-top: 12px;"></div>
     </form>
    </div>
   </div>
   
<!-- Tela 2.0: Home -->
   <div id="screen-home" class="screen">
    <div class="header">
     <h1>üè† In√≠cio</h1>
     <p id="welcomeText">Bem-vindo, usu√°rio!</p>
     <button class="btn btn-secondary" style="position: absolute; top: 20px; right: 20px; padding: 8px 16px; font-size: 14px;" onclick="logout()">Logout</button>
    </div>
    <div class="content">
     <div style="text-align: center; padding: 40px 20px;">
      <div style="font-size: 80px; margin-bottom: 24px;">
       üõ°Ô∏è
      </div>
      <h2 style="margin: 0 0 12px 0; color: #333;">Anjo da Guarda</h2>
      <p id="homeInstructions" style="margin: 0; color: #666; font-size: 16px; line-height: 1.6;">Use o menu abaixo para acessar as funcionalidades do sistema. Em caso de emerg√™ncia, clique no bot√£o vermelho.</p>
     </div>
    </div><button class="emergency-btn" id="emergencyBtn" onclick="handleEmergency()" style="display: none;">üö®</button>
    <nav class="nav-bottom" id="mainNavigation"><button class="nav-item active" onclick="showScreen('screen-home')"> <span class="icon">üè†</span> <span class="label">In√≠cio</span> </button> <button class="nav-item" id="navReport" onclick="showScreen('screen-report')" style="display: none;"> <span class="icon">üìù</span> <span class="label">Den√∫ncia</span> </button> <button class="nav-item" id="navReports" onclick="showScreen('screen-reports')" style="display: none;"> <span class="icon">üìã</span> <span class="label">Processos</span> </button> <button class="nav-item" id="navChat" onclick="showScreen('screen-chat')" style="display: none;"> <span class="icon">üí¨</span> <span class="label">Chat</span> </button> <button class="nav-item" id="navMap" onclick="showScreen('screen-map')" style="display: none;"> <span class="icon">üó∫Ô∏è</span> <span class="label">Mapa</span> </button> <button class="nav-item" id="navGames" onclick="showScreen('screen-games')" style="display: none;"> <span class="icon">üéÆ</span> <span class="label">Jogos</span> </button>
    </nav>
   </div><!-- Tela 3.1: Formul√°rio de Den√∫ncia -->
   <div id="screen-report" class="screen">
    <div class="header" style="position: relative;"><button class="back-btn" onclick="showScreen('screen-home')">‚Üê</button>
     <h1>üìù Nova Den√∫ncia</h1>
     <p>Registre uma den√∫ncia de forma segura</p>
    </div>
    <div class="content">
     <form class="report-form" id="reportForm">
      <div class="form-group"><label for="violenceType">Tipo de Viol√™ncia</label> <select id="violenceType" required> <option value="">Selecione o tipo</option> <option value="fisica">Viol√™ncia F√≠sica</option> <option value="psicologica">Viol√™ncia Psicol√≥gica</option> <option value="sexual">Viol√™ncia Sexual</option> <option value="negligencia">Neglig√™ncia</option> <option value="exploracao">Explora√ß√£o</option> <option value="outro">Outro</option> </select>
      </div>
      <div class="form-group"><label for="description">Descri√ß√£o do Ocorrido</label> <textarea id="description" placeholder="Descreva detalhadamente o que aconteceu..." required></textarea>
      </div>
      <div class="form-group"><label for="date">Data do Ocorrido</label> <input type="date" id="date" required>
      </div>
      <div class="form-group"><label for="location">Local/Endere√ßo</label> <input type="text" id="location" placeholder="Rua, bairro, cidade" required>
      </div>
      <div class="form-group"><label for="victimName">Nome da V√≠tima (se souber)</label> <input type="text" id="victimName" placeholder="Nome completo ou apelido">
      </div>
      <div class="form-group"><label for="victimAge">Faixa Et√°ria da V√≠tima</label> <select id="victimAge" required> <option value="">Selecione</option> <option value="0-3">0 a 3 anos</option> <option value="4-7">4 a 7 anos</option> <option value="8-12">8 a 12 anos</option> <option value="13-17">13 a 17 anos</option> </select>
      </div>
      <div class="form-group"><label for="victimGender">G√™nero da V√≠tima</label> <select id="victimGender" required> <option value="">Selecione</option> <option value="masculino">Masculino</option> <option value="feminino">Feminino</option> <option value="outro">Outro</option> </select>
      </div>
      <div class="form-group"><label for="relationshipVictim">Seu relacionamento com a v√≠tima</label> <select id="relationshipVictim" required> <option value="">Selecione</option> <option value="pai">Pai/M√£e</option> <option value="familiar">Familiar</option> <option value="amigo">Amigo</option> <option value="vizinho">Vizinho</option> <option value="professor">Professor</option> <option value="outro">Outro</option> </select>
      </div>
      <div class="form-group"><label for="aggressorName">Nome do Agressor (se souber)</label> <input type="text" id="aggressorName" placeholder="Nome completo ou apelido">
      </div>
      <div class="form-group"><label for="aggressorRelation">Rela√ß√£o do agressor com a v√≠tima</label> <select id="aggressorRelation" required> <option value="">Selecione</option> <option value="pai">Pai/M√£e</option> <option value="familiar">Familiar</option> <option value="amigo">Amigo</option> <option value="vizinho">Vizinho</option> <option value="professor">Professor</option> <option value="desconhecido">Desconhecido</option> <option value="outro">Outro</option> </select>
      </div>
      <div class="checkbox-group"><input type="checkbox" id="livesTogether"> <label for="livesTogether">V√≠tima mora com o agressor?</label>
      </div>
      <div class="checkbox-group"><input type="checkbox" id="anonymous"> <label for="anonymous">Den√∫ncia an√¥nima</label>
      </div><button type="submit" class="btn btn-primary" id="submitReportBtn"> <span id="submitReportText">Enviar Den√∫ncia</span> </button>
     </form>
    </div>
   </div><!-- Tela 3.2: Confirma√ß√£o de Den√∫ncia -->
   <div id="screen-confirmation" class="screen">
    <div class="header" style="position: relative;"><button class="back-btn" onclick="showScreen('screen-home')">‚Üê</button>
     <h1>‚úÖ Den√∫ncia Registrada</h1>
     <p>Seu protocolo foi gerado com sucesso</p>
    </div>
    <div class="content">
     <div class="success-box">
      <div class="icon">‚úÖ</div>
      <h2>Den√∫ncia Enviada</h2>
      <p>Protocolo:</p>
      <div class="protocol" id="protocolNumber">PRO-XXXXXXXX</div>
      <p>Voc√™ pode acompanhar o status na se√ß√£o de Processos.</p>
     </div><button class="btn btn-primary" onclick="showScreen('screen-reports')">Ver Meus Processos</button> <button class="btn btn-secondary" style="margin-top: 12px;" onclick="showScreen('screen-home')">Voltar ao In√≠cio</button>
    </div>
   </div><!-- Tela 4.0: Lista de Processos -->
   <div id="screen-reports" class="screen">
    <div class="header" style="position: relative;"><button class="back-btn" onclick="showScreen('screen-home')">‚Üê</button>
     <h1>üìã Meus Processos</h1>
     <p>Acompanhe o status das den√∫ncias</p>
    </div>
    <div class="content">
     <div id="reportsList" class="reports-list"></div>
    </div>
   </div><!-- Tela 5.0: Mapa -->
   <div id="screen-map" class="screen">
    <div class="header" style="position: relative;"><button class="back-btn" onclick="showScreen('screen-home')">‚Üê</button>
     <h1>üó∫Ô∏è Mapa de Apoio</h1>
     <p>Encontre locais de ajuda pr√≥ximos</p>
    </div>
    <div class="content">
     <div class="map-container">
      <div class="map-markers"> <span class="map-marker" style="left: 20%; top: 40%;" onclick="showPlace('delegacia')">üëÆ</span> <span class="map-marker" style="left: 60%; top: 30%;" onclick="showPlace('hospital')">üè•</span> <span class="map-marker" style="left: 40%; top: 70%;" onclick="showPlace('conselho')">üèõÔ∏è</span> <span class="map-marker" style="left: 80%; top: 50%;" onclick="showPlace('cras')">üè†</span> </div>
     </div>
     <div class="places-list"> <div class="place-item" onclick="showPlace('delegacia')">
       <div class="place-header">
        <span class="place-icon">üëÆ</span>
        <div class="place-info">
         <h3>Delegacia Especializada</h3>
         <p>Prote√ß√£o √† Crian√ßa</p>
        </div>
       </div> </div> <div class="place-item" onclick="showPlace('hospital')">
       <div class="place-header">
        <span class="place-icon">üè•</span>
        <div class="place-info">
         <h3>Hospital Infantil</h3>
         <p>Atendimento M√©dico</p>
        </div>
       </div> </div> <div class="place-item" onclick="showPlace('conselho')">
       <div class="place-header">
        <span class="place-icon">üèõÔ∏è</span>
        <div class="place-info">
         <h3>Conselho Tutelar</h3>
         <p>Defesa de Direitos</p>
        </div>
       </div> </div> <div class="place-item" onclick="showPlace('cras')">
       <div class="place-header">
        <span class="place-icon">üè†</span>
        <div class="place-info">
         <h3>CRAS</h3>
         <p>Apoio Social</p>
        </div>
       </div> </div> </div>
    </div>
    <nav class="nav-bottom" id="mapNav"></nav>
   </div><!-- Tela 5.1: Detalhes do Local -->
   <div id="screen-place-details" class="screen">
    <div class="header" style="position: relative;"><button class="back-btn" onclick="showScreen('screen-map')">‚Üê</button>
     <h1 id="placeDetailTitle">Detalhes do Local</h1>
     <p>Informa√ß√µes e rota</p>
    </div>
    <div class="content">
     <div class="place-details">
      <h2 id="placeName">Nome do Local</h2>
      <div class="detail-row"> <span class="icon">üìç</span> <span class="text" id="placeAddress">Endere√ßo completo</span> </div>
      <div class="detail-row"> <span class="icon">üìû</span> <span class="text" id="placePhone">(XX) XXXX-XXXX</span> </div>
      <div class="detail-row"> <span class="icon">‚è∞</span> <span class="text" id="placeHours">Hor√°rio de funcionamento</span> </div>
     </div><button class="btn btn-primary" onclick="showRoute()">Ver Rota</button>
    </div>
   </div><!-- Tela 5.2: Rota -->
   <div id="screen-route" class="screen">
    <div class="header" style="position: relative;"><button class="back-btn" onclick="showScreen('screen-place-details')">‚Üê</button>
     <h1>üõ£Ô∏è Rota para o Local</h1>
     <p>Como chegar</p>
    </div>
    <div class="content">
     <div class="route-map">
      <div class="icon">üó∫Ô∏è</div>
      <p>Rota simulada</p>
     </div>
     <div class="route-info">
      <h3>Passos da Rota</h3>
      <div class="route-step">
       <span class="step-number">1</span>
       <span class="step-text">Saia de casa e vire √† esquerda na rua principal</span>
      </div>
      <div class="route-step">
       <span class="step-number">2</span>
       <span class="step-text">Pegue o √¥nibus linha 123 dire√ß√£o centro</span>
      </div>
      <div class="route-step">
       <span class="step-number">3</span>
       <span class="step-text">Des√ßa no ponto ap√≥s o supermercado</span>
      </div>
      <div class="route-step">
       <span class="step-number">4</span>
       <span class="step-text">Caminhe 200m √† direita at√© o local</span>
      </div>
     </div>
    </div>
   </div><!-- Tela 6.0: Jogos -->
<div id="screen-games" class="screen">
    <div class="header" style="position: relative;">
        <button class="back-btn" onclick="showScreen('screen-home')">‚Üê</button>
        <h1>üéÆ Jogos e Quizzes</h1>
        <p>Aprenda brincando!</p>
    </div>

    <div class="content">
        <div class="games-grid" style="margin-top: 20px; grid-template-columns: 1fr 1fr;">
            
            <div class="game-card" onclick="startQuiz('meusDireitos')">
                <div class="icon" style="font-size: 60px;">üìö</div>
                <h3>Meus Direitos</h3>
            </div>

            <div class="game-card" onclick="startQuiz('prevencao')">
                <div class="icon" style="font-size: 60px;">üõ°Ô∏è</div>
                <h3>Preven√ß√£o</h3>
            </div>

            <div class="game-card" onclick="startQuiz('seguranca')">
                <div class="icon" style="font-size: 60px;">üîí</div>
                <h3>Seguran√ßa</h3>
            </div>

            <div class="game-card" onclick="startQuiz('pedirAjuda')">
                <div class="icon" style="font-size: 60px;">üÜò</div>
                <h3>Pedir Ajuda</h3>
            </div>

        </div>
    </div>
</div>
<!-- Tela 6.1: Quiz -->
   <div id="screen-quiz" class="screen">
    <div class="header" style="position: relative;"><button class="back-btn" onclick="showScreen('screen-games')">‚Üê</button>
     <h1 id="quizTitle">Quiz</h1>
     <p>Leia a pergunta e clique na op√ß√£o que considerar correta!</p>
    </div>
    <div class="content quiz-container">
     <div class="question-box">
      <h2 id="questionText">Pergunta aqui</h2>
      <div class="options" id="optionsContainer"></div>
     </div>
    </div>
   </div><!-- Tela 6.2: Pontua√ß√£o -->
   <div id="screen-score" class="screen">
    <div class="header" style="position: relative;"><button class="back-btn" onclick="showScreen('screen-games')">‚Üê</button>
     <h1>üèÜ Pontua√ß√£o</h1>
     <p>Veja seu resultado</p>
    </div>
    <div class="content">
     <div class="score-display">
      <div class="icon">üéâ</div>
      <h2 id="scoreText">0/0</h2>
      <p id="scoreMessage">Mensagem aqui</p><button class="btn btn-primary" onclick="showScreen('screen-games')">Jogar Novamente</button> <button class="btn btn-secondary" style="margin-top: 12px;" onclick="showScreen('screen-home')">Voltar ao In√≠cio</button>
     </div>
    </div>
   </div><!-- Tela 7.0: Chat Inicial -->
   <div id="screen-chat" class="screen">
    <div class="header" style="position: relative;"><button class="back-btn" onclick="showScreen('screen-home')">‚Üê</button>
     <h1>üí¨ Anjo da Guarda</h1>
     <p>Converse com nosso assistente</p>
    </div>
    <div class="content chat-container">
     <div class="chat-messages" id="chatMessages">
      <div class="message bot">Ol√°! Como posso te ajudar hoje? üòä</div>
     </div>
     <div class="chat-options"> <button class="chat-option-btn" onclick="sendChatOption('O que √© viol√™ncia?')">O que √© viol√™ncia?</button> <button class="chat-option-btn" onclick="sendChatOption('Quais s√£o meus direitos?')">Quais s√£o meus direitos?</button> <button class="chat-option-btn" onclick="sendChatOption('Preciso de ajuda')">Preciso de ajuda</button> <button class="chat-option-btn" onclick="startConversation()">Quero conversar</button> </div>
    </div>
   </div><!-- Tela 7.1: Conversa -->
   <div id="screen-chat-conversation" class="screen">
    <div class="human-attendant-banner" id="humanAttendantBanner" style="display: none;">
     <strong>Atendente Humano Conectado</strong> <span>Estamos aqui para te ajudar</span>
    </div>
    <div class="header" style="position: relative;"><button class="back-btn" onclick="backToChat()">‚Üê</button>
     <h1>üí¨ Anjo da Guarda</h1>
     <p>Converse com nosso assistente</p>
    </div>
    <div class="content chat-container">
     <div class="chat-messages" id="conversationMessages"></div>
    </div>
    <div class="chat-input-container">
     <form class="chat-input-form" id="chatForm">
      <input type="text" class="chat-input" id="chatInput" placeholder="Digite sua mensagem..."> <button type="submit" class="chat-send-btn">‚û§</button>
     </form>
    </div>
   </div><!-- Tela 8.0: Lista de Atendimentos (Profissional) -->
   <div id="screen-attend-list" class="screen">
    <div class="header" style="position: relative;"><button class="back-btn" onclick="showScreen('screen-home')">‚Üê</button>
     <h1>üë• Atendimentos</h1>
     <p>Chats em andamento</p>
    </div>
    <div class="content">
     <div id="chatListContainer"></div>
    </div>
   </div><!-- Tela 8.1: Chat de Atendimento (Profissional) -->
   <div id="screen-attend-chat" class="screen">
    <div class="header" style="position: relative;"><button class="back-btn" onclick="showScreen('screen-attend-list')">‚Üê</button>
     <h1 id="attendChatName">Chat</h1>
     <p>Atendimento profissional</p>
    </div>
    <div class="content chat-container">
     <div class="chat-messages" id="attendChatMessages"></div>
    </div>
    <div class="chat-input-container">
     <form class="chat-input-form" id="attendChatForm">
      <input type="text" class="chat-input" id="attendChatInput" placeholder="Digite sua mensagem..."> <button type="submit" class="chat-send-btn">‚û§</button>
     </form>
    </div>
   </div>
  </div>
  <script>
    let currentUser = null;
    let currentQuiz = null;
    let currentQuestion = 0;
    let quizScore = 0;
    let currentPlace = null;
    let currentChatId = null;

    // Simulated data
    const places = {
      'delegacia': {
        name: 'Delegacia Especializada',
        address: 'Rua da Prote√ß√£o, 123 - Centro',
        phone: '(11) 9999-9999',
        hours: '24 horas'
      },
      'hospital': {
        name: 'Hospital Infantil',
        address: 'Av. Sa√∫de, 456 - Bairro Sa√∫de',
        phone: '(11) 8888-8888',
        hours: '24 horas'
      },
      'conselho': {
        name: 'Conselho Tutelar',
        address: 'Pra√ßa dos Direitos, 789 - Centro',
        phone: '(11) 7777-7777',
        hours: 'Seg-Sex: 8h-18h'
      },
      'cras': {
        name: 'CRAS - Centro de Refer√™ncia',
        address: 'Rua Social, 101 - Bairro Social',
        phone: '(11) 6666-6666',
        hours: 'Seg-Sex: 8h-17h'
      }
    };

    const quizzes = {

    meusDireitos: {
        title: "Meus Direitos",
        questions: [
            {
                question: "Toda crian√ßa tem direito a‚Ä¶",
                options: [
                    "Ter uma vida segura e protegida",
                    "Fazer tudo sempre sozinha",
                    "Nunca ir √† escola",
                    "Trabalhar desde pequena"
                ],
                correct: 0
            },
            {
                question: "Qual documento protege os direitos das crian√ßas?",
                options: [
                    "A Constitui√ß√£o Federal",
                    "As regras da escola",
                    "O contrato de videogame",
                    "O caderno de provas"
                ],
                correct: 0
            }
        ]
    },

    prevencao: {
        title: "Preven√ß√£o",
        questions: [
            {
                question: "Se um adulto pedir segredo sobre algo que te deixa desconfort√°vel, voc√™ deve‚Ä¶",
                options: [
                    "Guardar o segredo",
                    "Contar imediatamente a um adulto de confian√ßa",
                    "Fingir que nada aconteceu",
                    "Pedir para o adulto repetir"
                ],
                correct: 1
            },
            {
                question: "Qual √© um sinal de situa√ß√£o perigosa?",
                options: [
                    "Algu√©m te oferecer doces insistindo",
                    "Brincar no parquinho",
                    "Estar com amigos na escola",
                    "Receber um elogio"
                ],
                correct: 0
            }
        ]
    },

    seguranca: {
        title: "Seguran√ßa",
        questions: [
            {
                question: "Quem voc√™ deve procurar se estiver em perigo?",
                options: [
                    "Um adulto de confian√ßa",
                    "Qualquer pessoa desconhecida",
                    "Ningu√©m, melhor ficar quieto",
                    "Procura sozinho uma sa√≠da"
                ],
                correct: 0
            },
            {
                question: "√â seguro compartilhar informa√ß√µes pessoais na internet?",
                options: [
                    "Sim, sempre!",
                    "N√£o, isso pode ser perigoso!",
                    "S√≥ com amigos virtuais",
                    "S√≥ com desconhecidos legais"
                ],
                correct: 1
            }
        ]
    },

    pedirAjuda: {
        title: "Pedir Ajuda",
        questions: [
            {
                question: "Quando voc√™ deve pedir ajuda?",
                options: [
                    "Sempre que estiver com medo ou machucado",
                    "Somente se for algo muito grave",
                    "Nunca, resolva tudo sozinho",
                    "Somente quando algu√©m disser"
                ],
                correct: 0
            },
            {
                question: "Quem pode te ajudar?",
                options: [
                    "Um adulto de confian√ßa",
                    "Qualquer pessoa na rua",
                    "Apenas crian√ßas mais velhas",
                    "Ningu√©m"
                ],
                correct: 0
            }
        ]
    }

};


    const simulatedChats = [
      {
        id: 'chat1',
        childName: 'Crian√ßa An√¥nima 1',
        time: 'Agora',
        lastMessage: 'Preciso de ajuda urgente...',
        urgent: true,
        messages: [
          { role: 'child', content: 'Ol√°, estou com medo' },
          { role: 'bot', content: 'Entendo. Pode me contar mais?' },
          { role: 'child', content: 'Algu√©m me machucou' }
        ]
      },
      {
        id: 'chat2',
        childName: 'Crian√ßa An√¥nima 2',
        time: '5 min atr√°s',
        lastMessage: 'Quero saber sobre meus direitos',
        urgent: false,
        messages: [
          { role: 'child', content: 'Quais s√£o meus direitos?' },
          { role: 'bot', content: 'Voc√™ tem direito √† prote√ß√£o, educa√ß√£o...' }
        ]
      }
    ];

    // Fallback for dataSdk using localStorage
    if (!window.dataSdk) {
      window.dataSdk = {
        handler: null,
        async init(handler) {
          this.handler = handler;
          return { isOk: true };
        },
        async query(filter) {
          const appData = JSON.parse(localStorage.getItem('appData') || '{}');
          const items = appData[filter.type] || [];
          if (filter.email) {
            return items.filter(item => item.email === filter.email);
          }
          return items;
        },
        async create(item) {
          const appData = JSON.parse(localStorage.getItem('appData') || '{}');
          if (!appData[item.type]) appData[item.type] = [];
          appData[item.type].push(item);
          localStorage.setItem('appData', JSON.stringify(appData));
          if (this.handler && typeof this.handler.onDataChanged === 'function') {
            const data = await this.query({type: item.type});
            this.handler.onDataChanged(data);
          }
          return { isOk: true };
        }
      };
    }

    // Show screen
    function showScreen(screenId) {
      document.querySelectorAll('.screen').forEach(screen => {
        screen.classList.remove('active');
      });
      document.getElementById(screenId).classList.add('active');

      const emergencyBtn = document.getElementById('emergencyBtn');
      if (currentUser && currentUser.profile === 'child' && screenId === 'screen-home') {
        emergencyBtn.style.display = 'block';
      } else {
        emergencyBtn.style.display = 'none';
      }

      if (screenId === 'screen-reports') {
        window.dataSdk.query({type: 'report'}).then(renderReportsList);
      }

      if (screenId === 'screen-attend-list') {
        renderChatList();
      }
    }

    // Setup profile
    async function setupProfile(profile, email) {
      if (!profile) return;

      currentUser = { email, profile, userId: email }; // Use email as userId for simplicity

      document.getElementById('welcomeText').textContent = `Bem-vindo, ${profile === 'child' ? 'Crian√ßa' : profile === 'parent' ? 'Pai/Cidad√£o' : 'Profissional'}!`;
      
      // Hide all nav items first
      document.querySelectorAll('.nav-item').forEach(item => item.style.display = 'none');

      // Show common items
      document.querySelector('[onclick="showScreen(\'screen-home\')"]').style.display = 'block';

      if (profile === 'child') {
        document.getElementById('homeInstructions').textContent = 'Use o menu abaixo para acessar as funcionalidades do sistema. Em caso de emerg√™ncia, clique no bot√£o vermelho.';
        document.getElementById('navChat').style.display = 'block';
        document.getElementById('navMap').style.display = 'block';
        document.getElementById('navGames').style.display = 'block';
      } else if (profile === 'parent') {
        document.getElementById('homeInstructions').textContent = 'Use o menu abaixo para acessar as funcionalidades do sistema.';
        document.getElementById('navReport').style.display = 'block';
        document.getElementById('navReports').style.display = 'block';
        document.getElementById('navMap').style.display = 'block';
      } else if (profile === 'professional') {
        document.getElementById('homeInstructions').textContent = 'Use o menu abaixo para acessar o atendimento √†s crian√ßas.';
        document.getElementById('navReports').style.display = 'block';
        document.getElementById('navChat').style.display = 'none'; // Profissionais t√™m lista de atendimentos separada
      }

      // Fetch and render reports
      const data = await window.dataSdk.query({type: 'report'});
      renderReportsList(data);

      if (profile === 'professional') {
        renderChatList();
        document.getElementById('mainNavigation').innerHTML = `
          <button class="nav-item active" onclick="showScreen('screen-home')">
            <span class="icon">üè†</span>
            <span class="label">In√≠cio</span>
          </button>
          <button class="nav-item" onclick="showScreen('screen-attend-list')">
            <span class="icon">üë•</span>
            <span class="label">Atendimentos</span>
          </button>
        `;
      }

      const mapNav = document.getElementById('mapNav');
      if (profile === 'child') {
        if (mapNav) {
          mapNav.innerHTML = `
            <button class="nav-item" onclick="showScreen('screen-home')">
                <span class="icon">üè†</span><span class="label">In√≠cio</span>
            </button>
            <button class="nav-item" onclick="showScreen('screen-chat')">
                <span class="icon">üí¨</span><span class="label">Chat</span>
            </button>
            <button class="nav-item active" onclick="showScreen('screen-map')">
                <span class="icon">üó∫Ô∏è</span><span class="label">Mapa</span>
            </button>
            <button class="nav-item" onclick="showScreen('screen-games')">
                <span class="icon">üéÆ</span><span class="label">Jogos</span>
            </button>`;
        }
      }
      if (profile === 'parent') {
        if (mapNav) {
          mapNav.innerHTML = `
            <button class="nav-item" onclick="showScreen('screen-home')">
                <span class="icon">üè†</span><span class="label">In√≠cio</span>
            </button>
            <button class="nav-item" onclick="showScreen('screen-report')">
                <span class="icon">üìù</span><span class="label">Den√∫ncia</span>
            </button>
            <button class="nav-item" onclick="showScreen('screen-reports')">
                <span class="icon">üìã</span><span class="label">Processos</span>
            </button>
            <button class="nav-item active" onclick="showScreen('screen-map')">
                <span class="icon">üó∫Ô∏è</span><span class="label">Mapa</span>
            </button>`;
        }
      }

      showScreen('screen-home');
    }

    // Initialize app
    async function initApp() {
      if (window.dataSdk) {
        // Optional: Initialize if needed
      }
    }

    // Login form
    document.getElementById('loginForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      const email = document.getElementById('email').value.toLowerCase();
      const password = document.getElementById('password').value;
      const errorDiv = document.getElementById('loginError');
      errorDiv.textContent = '';

      const users = await window.dataSdk.query({type: 'user', email: email});
      if (users.length === 0) {
        errorDiv.textContent = 'Email n√£o cadastrado';
        return;
      }
      const user = users[0];
      if (user.password !== password) {
        errorDiv.textContent = 'Senha incorreta';
        return;
      }
      setupProfile(user.profile, email);
    });

    // Create account button
    document.getElementById('createAccountBtn').addEventListener('click', function() {
      showScreen('screen-register');
    });

    // Register form
    document.getElementById('registerForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      const email = document.getElementById('regEmail').value.toLowerCase();
      const password = document.getElementById('regPassword').value;
      const profile = document.getElementById('userType').value;
      const errorDiv = document.getElementById('registerError');
      errorDiv.textContent = '';

      if (!profile) {
        errorDiv.textContent = 'Selecione o tipo de usu√°rio';
        return;
      }

      const existing = await window.dataSdk.query({type: 'user', email: email});
      if (existing.length > 0) {
        errorDiv.textContent = 'Email j√° cadastrado';
        return;
      }

      const userData = {
        type: 'user',
        email: email,
        password: password, // Note: In production, hash this!
        profile: profile,
        createdAt: new Date().toISOString()
      };

      const result = await window.dataSdk.create(userData);
      if (result.isOk) {
        // Success
        alert('Conta criada com sucesso! Agora fa√ßa login.');
        document.getElementById('registerForm').reset();
        showScreen('screen-login');
      } else {
        errorDiv.textContent = 'Erro ao criar conta. Tente novamente.';
      }
    });

    // Report form
    document.getElementById('reportForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      
      const submitBtn = document.getElementById('submitReportBtn');
      const submitText = document.getElementById('submitReportText');
      
      // Show loading state
      submitBtn.disabled = true;
      submitText.innerHTML = '<span class="loading"></span> Enviando...';
      
      const violenceType = document.getElementById('violenceType').value;
      const description = document.getElementById('description').value;
      const date = document.getElementById('date').value;
      const location = document.getElementById('location').value;
      const victimName = document.getElementById('victimName').value;
      const victimAge = document.getElementById('victimAge').value;
      const victimGender = document.getElementById('victimGender').value;
      const relationshipVictim = document.getElementById('relationshipVictim').value;
      const aggressorName = document.getElementById('aggressorName').value;
      const aggressorRelation = document.getElementById('aggressorRelation').value;
      const livesTogether = document.getElementById('livesTogether').checked;
      const anonymous = document.getElementById('anonymous').checked;
      
      const protocol = 'PRO-' + Date.now().toString().slice(-8);
      
      const reportData = {
        id: 'report-' + Date.now(),
        type: 'report',
        userId: currentUser.userId,
        violenceType: violenceType,
        description: description,
        date: date,
        location: location,
        victimName: victimName,
        victimAge: victimAge,
        victimGender: victimGender,
        relationshipVictim: relationshipVictim,
        aggressorName: aggressorName,
        aggressorRelation: aggressorRelation,
        livesTogether: livesTogether ? 'yes' : 'no',
        anonymous: anonymous,
        status: 'pending',
        protocol: protocol,
        createdAt: new Date().toISOString()
      };

      const result = await window.dataSdk.create(reportData);
      
      // Reset button state
      submitBtn.disabled = false;
      submitText.textContent = 'Enviar Den√∫ncia';
      
      if (result.isOk) {
        document.getElementById('protocolNumber').textContent = protocol;
        document.getElementById('reportForm').reset();
        showScreen('screen-confirmation');
      } else {
        const errorMsg = document.createElement('div');
        errorMsg.style.cssText = 'background: #ffebee; border: 2px solid #f44336; border-radius: 8px; padding: 12px; margin-top: 12px; color: #c62828; text-align: center;';
        errorMsg.textContent = 'Erro ao enviar den√∫ncia. Tente novamente.';
        document.querySelector('#reportForm').appendChild(errorMsg);
        setTimeout(() => errorMsg.remove(), 3000);
      }
    });

    // Render reports list
    function renderReportsList(data) {
      const reportsList = document.getElementById('reportsList');
      if (!reportsList) return;

      let userReports = data.filter(item => item.type === 'report' && (currentUser.profile === 'professional' || item.userId === currentUser.userId));

      if (userReports.length === 0) {
        reportsList.innerHTML = `
          <div class="empty-state">
            <div class="icon">üìã</div>
            <p>Nenhum processo registrado ainda</p>
          </div>
        `;
        return;
      }

      reportsList.innerHTML = userReports.map(report => {
        const statusClass = report.status === 'pending' ? 'status-pending' : 
                          report.status === 'analyzing' ? 'status-analyzing' : 'status-completed';
        const statusText = report.status === 'pending' ? 'Aguardando an√°lise' : 
                         report.status === 'analyzing' ? 'Em an√°lise' : 'Analisada';
        
        return `
          <div class="report-item">
            <div class="report-header">
              <span class="report-protocol">${report.protocol}</span>
              <span class="status-badge ${statusClass}">${statusText}</span>
            </div>
            <p style="margin: 8px 0 4px 0; color: #666; font-size: 14px;">
              <strong>Tipo:</strong> ${getViolenceTypeLabel(report.violenceType)}
            </p>
            <p style="margin: 4px 0; color: #666; font-size: 14px;">
              <strong>Local:</strong> ${report.location}
            </p>
            <p style="margin: 4px 0; color: #666; font-size: 14px;">
              <strong>Data:</strong> ${new Date(report.date).toLocaleDateString('pt-BR')}
            </p>
          </div>
        `;
      }).join('');
    }

    function getViolenceTypeLabel(type) {
      const labels = {
        'fisica': 'Viol√™ncia F√≠sica',
        'psicologica': 'Viol√™ncia Psicol√≥gica',
        'sexual': 'Viol√™ncia Sexual',
        'negligencia': 'Neglig√™ncia',
        'exploracao': 'Explora√ß√£o',
        'outro': 'Outro'
      };
      return labels[type] || type;
    }

    // Render chat list for professionals
    function renderChatList() {
      const container = document.getElementById('chatListContainer');
      if (!container) return;

      container.innerHTML = simulatedChats.map(chat => `
        <div class="chat-list-item ${chat.urgent ? 'urgent' : ''}" onclick="openProfessionalChat('${chat.id}')">
          <div class="chat-list-header">
            <span class="chat-list-name">
              ${chat.childName}
              ${chat.urgent ? '<span class="urgent-badge">URGENTE</span>' : ''}
            </span>
            <span class="chat-list-time">${chat.time}</span>
          </div>
          <p class="chat-list-preview">${chat.lastMessage}</p>
        </div>
      `).join('');
    }

    // Open professional chat
    function openProfessionalChat(chatId) {
      currentChatId = chatId;
      const chat = simulatedChats.find(c => c.id === chatId);
      
      if (!chat) return;

      document.getElementById('attendChatName').textContent = 'üë§ ' + chat.childName;
      
      const messagesContainer = document.getElementById('attendChatMessages');
      messagesContainer.innerHTML = chat.messages.map(msg => `
        <div class="message ${msg.role === 'child' ? 'bot' : 'user'}">
          ${msg.content}
        </div>
      `).join('');

      showScreen('screen-attend-chat');
      messagesContainer.scrollTop = messagesContainer.scrollHeight;
    }

    // Handle professional chat form
    document.getElementById('attendChatForm').addEventListener('submit', function(e) {
      e.preventDefault();
      
      const input = document.getElementById('attendChatInput');
      const message = input.value.trim();
      
      if (!message) return;
      
      const messagesContainer = document.getElementById('attendChatMessages');
      
      // Add professional message
      const profMsg = document.createElement('div');
      profMsg.className = 'message user';
      profMsg.textContent = message;
      messagesContainer.appendChild(profMsg);
      
      input.value = '';
      messagesContainer.scrollTop = messagesContainer.scrollHeight;

      // Simulate child response
      setTimeout(() => {
        const childMsg = document.createElement('div');
        childMsg.className = 'message bot';
        childMsg.textContent = 'Obrigado por me ouvir...';
        messagesContainer.appendChild(childMsg);
        messagesContainer.scrollTop = messagesContainer.scrollHeight;
      }, 2000);
    });

    // Emergency button handler - ALWAYS goes to chat
    function handleEmergency() {
      showScreen('screen-chat');
    }

    // Quiz functions
    function startQuiz(quizType) {
      currentQuiz = quizzes[quizType];
      currentQuestion = 0;
      quizScore = 0;
      
      document.getElementById('quizTitle').textContent = currentQuiz.title;
      loadQuestion();
      showScreen('screen-quiz');
    }

    function loadQuestion() {
      if (currentQuestion >= currentQuiz.questions.length) {
        showScore();
        return;
      }

      const question = currentQuiz.questions[currentQuestion];
      document.getElementById('questionText').textContent = question.question;
      
      const optionsContainer = document.getElementById('optionsContainer');
      optionsContainer.innerHTML = question.options.map((option, index) => `
        <button class="option-btn" onclick="checkAnswer(${index})">${option}</button>
      `).join('');
    }

    function checkAnswer(selectedIndex) {
      const question = currentQuiz.questions[currentQuestion];
      const buttons = document.querySelectorAll('.option-btn');
      
      buttons.forEach((btn, index) => {
        btn.disabled = true;
        if (index === question.correct) {
          btn.classList.add('correct');
        } else if (index === selectedIndex && selectedIndex !== question.correct) {
          btn.classList.add('incorrect');
        }
      });

      if (selectedIndex === question.correct) {
        quizScore++;
      }

      setTimeout(() => {
        currentQuestion++;
        loadQuestion();
      }, 1500);
    }

    function showScore() {
      const total = currentQuiz.questions.length;
      const percentage = (quizScore / total) * 100;
      
      document.getElementById('scoreText').textContent = `${quizScore}/${total}`;
      
      let message = '';
      if (percentage === 100) {
        message = 'üéâ Perfeito! Voc√™ acertou todas!';
      } else if (percentage >= 70) {
        message = 'üòä Muito bem! Continue aprendendo!';
      } else {
        message = 'üí™ Continue praticando, voc√™ vai melhorar!';
      }
      
      document.getElementById('scoreMessage').textContent = message;
      showScreen('screen-score');
    }

    // Place functions
    function showPlace(placeId) {
      currentPlace = places[placeId];
      
      document.getElementById('placeDetailTitle').textContent = currentPlace.name;
      document.getElementById('placeName').textContent = currentPlace.name;
      document.getElementById('placeAddress').textContent = currentPlace.address;
      document.getElementById('placePhone').textContent = currentPlace.phone;
      document.getElementById('placeHours').textContent = currentPlace.hours;
      
      showScreen('screen-place-details');
    }

    function showRoute() {
      showScreen('screen-route');
    }

    // Chat state
    let conversationHistory = [];
    let isHumanAttendant = false;
    let messageCount = 0;

    // Chat functions
    function sendChatOption(option) {
      const messagesContainer = document.getElementById('chatMessages');
      
      // Add user message
      const userMsg = document.createElement('div');
      userMsg.className = 'message user';
      userMsg.textContent = option;
      messagesContainer.appendChild(userMsg);
      
      // Add bot response
      setTimeout(() => {
        const botMsg = document.createElement('div');
        botMsg.className = 'message bot';
        
        if (option.includes('viol√™ncia')) {
          botMsg.textContent = 'Sinais de viol√™ncia incluem: machucados inexplic√°veis, medo de adultos, mudan√ßas de comportamento repentinas. Se voc√™ perceber isso, converse com um adulto de confian√ßa.';
        } else if (option.includes('direitos')) {
          botMsg.textContent = 'Voc√™ tem direito √† educa√ß√£o, sa√∫de, alimenta√ß√£o, moradia, prote√ß√£o contra viol√™ncia e muito mais! Jogue o quiz sobre direitos para aprender mais!';
        } else if (option.includes('ajuda')) {
          botMsg.textContent = 'Estou aqui para te ajudar! Voc√™ pode usar o mapa para encontrar locais de apoio pr√≥ximos. Lembre-se: voc√™ n√£o est√° sozinho(a)!';
        }
        
        messagesContainer.appendChild(botMsg);
        messagesContainer.scrollTop = messagesContainer.scrollHeight;
      }, 800);
      
      messagesContainer.scrollTop = messagesContainer.scrollHeight;
    }

    // Start conversation mode
    function startConversation() {
      conversationHistory = [];
      isHumanAttendant = false;
      messageCount = 0;
      showScreen('screen-chat-conversation');
      const conversationMessages = document.getElementById('conversationMessages');
      conversationMessages.innerHTML = `
        <div class="message bot">
          Ol√°! Pode me contar o que est√° acontecendo. Estou aqui para ouvir voc√™. üòä
        </div>
      `;
      conversationMessages.scrollTop = conversationMessages.scrollHeight;
    }

    // Back to chat menu
    function backToChat() {
      conversationHistory = [];
      isHumanAttendant = false;
      messageCount = 0;
      
      // Reset conversation messages
      const conversationMessages = document.getElementById('conversationMessages');
      conversationMessages.innerHTML = '';
      
      // Hide human attendant banner
      document.getElementById('humanAttendantBanner').style.display = 'none';
      
      showScreen('screen-chat');
    }

    // Detect if message indicates violence
    function detectViolence(message) {
      const violenceKeywords = [
        'machucado', 'machucada', 'dor', 'bater', 'bateu', 'apanhar', 
        'viol√™ncia', 'violento', 'medo', 'assustado', 'assustada',
        'abuso', 'tocou', 'tocar', 'desconfort√°vel', 'ajuda urgente',
        'perigo', 'amea√ßa', 'sofrer', 'sofrendo', 'maltrato'
      ];
      
      const lowerMessage = message.toLowerCase();
      return violenceKeywords.some(keyword => lowerMessage.includes(keyword));
    }

    // Get bot response
    function getBotResponse(userMessage) {
      const lowerMessage = userMessage.toLowerCase();
      
      // Predefined responses
      if (lowerMessage.includes('oi') || lowerMessage.includes('ol√°')) {
        return 'Ol√°! Estou aqui para te ajudar. Pode me contar o que est√° acontecendo?';
      } else if (lowerMessage.includes('direitos')) {
        return 'Toda crian√ßa e adolescente tem direitos fundamentais: √† vida, sa√∫de, educa√ß√£o, prote√ß√£o contra viol√™ncia e muito mais! Quer saber mais sobre algum direito espec√≠fico?';
      } else if (lowerMessage.includes('escola')) {
        return 'A educa√ß√£o √© um direito de todas as crian√ßas. Se voc√™ est√° tendo problemas na escola, podemos te ajudar a encontrar apoio.';
      } else if (lowerMessage.includes('fam√≠lia')) {
        return 'A fam√≠lia √© importante, mas toda crian√ßa tem o direito de viver em um ambiente seguro e saud√°vel. Se algo n√£o est√° bem, voc√™ pode me contar.';
      } else if (lowerMessage.includes('amigo')) {
        return 'Os amigos s√£o muito importantes! Se algum amigo est√° passando por dificuldades, voc√™ pode ajud√°-lo falando com um adulto de confian√ßa.';
      } else if (lowerMessage.includes('sozinho') || lowerMessage.includes('sozinha')) {
        return 'Voc√™ nunca est√° sozinho(a). Existem muitas pessoas e profissionais prontos para te ajudar. Quer que eu mostre os locais de apoio pr√≥ximos?';
      } else {
        return 'Entendo. Pode me contar mais detalhes? Estou aqui para te ouvir e ajudar no que for poss√≠vel.';
      }
    }

    // Add typing indicator
    function showTypingIndicator(container) {
      const typing = document.createElement('div');
      typing.className = 'typing-indicator';
      typing.id = 'typingIndicator';
      typing.innerHTML = `
        <div class="typing-dot"></div>
        <div class="typing-dot"></div>
        <div class="typing-dot"></div>
      `;
      container.appendChild(typing);
      container.scrollTop = container.scrollHeight;
      return typing;
    }

    // Handle chat form submission (Tela 7.2)
    document.getElementById('chatForm').addEventListener('submit', function(e) {
      e.preventDefault();
      
      const input = document.getElementById('chatInput');
      const message = input.value.trim();
      
      if (!message) return;
      
      const messagesContainer = document.getElementById('conversationMessages');
      
      // Add user message
      const userMsg = document.createElement('div');
      userMsg.className = 'message user';
      userMsg.textContent = message;
      messagesContainer.appendChild(userMsg);
      
      conversationHistory.push({ role: 'user', content: message });
      messageCount++;
      
      input.value = '';
      messagesContainer.scrollTop = messagesContainer.scrollHeight;
      
      // Check for violence keywords
      const hasViolence = detectViolence(message);
      
      // Show typing indicator
      const typing = showTypingIndicator(messagesContainer);
      
      setTimeout(() => {
        // Remove typing indicator
        typing.remove();
        
        if (hasViolence && messageCount >= 2 && !isHumanAttendant) {
          // Show transfer message
          const transferMsg = document.createElement('div');
          transferMsg.className = 'message bot';
          transferMsg.innerHTML = 'üö® Percebi que voc√™ pode estar em uma situa√ß√£o delicada. Vou te conectar com um <strong>atendente humano</strong> que pode te ajudar melhor. Um momento...';
          messagesContainer.appendChild(transferMsg);
          
          // Show human attendant banner
          document.getElementById('humanAttendantBanner').style.display = 'flex';
          
          setTimeout(() => {
            const humanMsg = document.createElement('div');
            humanMsg.className = 'message bot';
            humanMsg.textContent = 'üë§ Profissional conectado! Ol√°, sou um profissional especializado. Li a conversa anterior. Pode me contar mais detalhes, estou aqui para te ajudar.';
            messagesContainer.appendChild(humanMsg);
            isHumanAttendant = true;
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
          }, 2000);
          
          messagesContainer.scrollTop = messagesContainer.scrollHeight;
        } else {
          // Regular bot response
          const botMsg = document.createElement('div');
          botMsg.className = 'message bot';
          botMsg.textContent = getBotResponse(message);
          messagesContainer.appendChild(botMsg);
          conversationHistory.push({ role: 'bot', content: botMsg.textContent });
          messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }
      }, 1000);
    });

    function logout() {
      currentUser = null;
      showScreen('screen-login');
    }

    // Initialize app when ready
    initApp();
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9a3c116d70d5cad7',t:'MTc2NDAyMDQ2MS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>